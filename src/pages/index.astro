---
import Layout from '../layouts/Layout.astro';
---

<Layout>
	<main class="container">
		<header>
			<h1>ğŸ² æ•°åˆ¶ç¼–ç é­”æ–¹</h1>
			<p>Number System & Coding Cube - è®¡ç®—æœºç»„æˆåŸç†å¯è§†åŒ–å­¦ä¹ å·¥å…·</p>
		</header>

		<div class="tools-grid">
			<!-- å®æ—¶å¤šè¿›åˆ¶è½¬æ¢å™¨ -->
			<section class="converter-section">
				<h2>ğŸ”„ å®æ—¶å¤šè¿›åˆ¶è½¬æ¢å™¨</h2>
				<div class="input-group">
					<label for="input-number">è¾“å…¥æ•°å€¼:</label>
					<input 
						type="text" 
						id="input-number" 
						placeholder="è¯·è¾“å…¥æ•°å€¼" 
						autocomplete="off"
					>
					<select id="input-base">
						<option value="2">äºŒè¿›åˆ¶ (Binary)</option>
						<option value="8">å…«è¿›åˆ¶ (Octal)</option>
						<option value="10" selected>åè¿›åˆ¶ (Decimal)</option>
						<option value="16">åå…­è¿›åˆ¶ (Hexadecimal)</option>
					</select>
				</div>
				
				<div class="conversion-results">
					<div class="result-item">
						<label>äºŒè¿›åˆ¶ (Binary):</label>
						<span id="result-binary" class="result-value">-</span>
					</div>
					<div class="result-item">
						<label>å…«è¿›åˆ¶ (Octal):</label>
						<span id="result-octal" class="result-value">-</span>
					</div>
					<div class="result-item">
						<label>åè¿›åˆ¶ (Decimal):</label>
						<span id="result-decimal" class="result-value">-</span>
					</div>
					<div class="result-item">
						<label>åå…­è¿›åˆ¶ (Hexadecimal):</label>
						<span id="result-hexadecimal" class="result-value">-</span>
					</div>
				</div>
			</section>

			<!-- æœºå™¨ç ç¼–ç è§£æå™¨ -->
			<section class="encoder-section">
				<h2>ğŸ”§ æœºå™¨ç ç¼–ç è§£æå™¨</h2>
				<div class="input-group">
					<label for="decimal-input">åè¿›åˆ¶æ•´æ•°:</label>
					<input 
						type="number" 
						id="decimal-input" 
						placeholder="è¾“å…¥æ­£æ•°æˆ–è´Ÿæ•°" 
						autocomplete="off"
					>
					<select id="bit-width">
						<option value="8">8ä½</option>
						<option value="16" selected>16ä½</option>
						<option value="32">32ä½</option>
					</select>
				</div>

				<div class="encoding-results">
					<div class="encoding-item">
						<h3>åŸç  (Sign-Magnitude)</h3>
						<div class="binary-display" id="sign-magnitude">-</div>
						<div class="explanation" id="sm-explanation"></div>
					</div>
					<div class="encoding-item">
						<h3>åç  (One's Complement)</h3>
						<div class="binary-display" id="ones-complement">-</div>
						<div class="explanation" id="oc-explanation"></div>
					</div>
					<div class="encoding-item">
						<h3>è¡¥ç  (Two's Complement)</h3>
						<div class="binary-display" id="twos-complement">-</div>
						<div class="explanation" id="tc-explanation"></div>
					</div>
				</div>
			</section>

			<!-- IEEE 754 å•ç²¾åº¦æµ®ç‚¹æ•°è½¬æ¢å™¨ -->
			<section class="ieee754-section">
				<h2>ğŸŒŠ IEEE 754 å•ç²¾åº¦æµ®ç‚¹æ•°è½¬æ¢å™¨</h2>
				<div class="input-group">
					<label for="float-input">æµ®ç‚¹æ•°:</label>
					<input 
						type="number" 
						id="float-input" 
						placeholder="è¾“å…¥æµ®ç‚¹æ•°" 
						step="any"
						autocomplete="off"
					>
				</div>

				<div class="ieee-results">
					<div class="ieee-bits">
						<div class="bit-group sign">
							<label>ç¬¦å·ä½ (1ä½)</label>
							<div class="bit-box" id="ieee-sign">-</div>
						</div>
						<div class="bit-group exponent">
							<label>æŒ‡æ•°ä½ (8ä½)</label>
							<div class="bit-box" id="ieee-exponent">-</div>
						</div>
						<div class="bit-group mantissa">
							<label>å°¾æ•°ä½ (23ä½)</label>
							<div class="bit-box" id="ieee-mantissa">-</div>
						</div>
					</div>
					<div class="ieee-hex">
						<label>åå…­è¿›åˆ¶è¡¨ç¤º:</label>
						<span id="ieee-hex-result">-</span>
					</div>
					<div class="ieee-explanation" id="ieee-explanation"></div>
				</div>
			</section>
		</div>
	</main>
</Layout>

<style>
	/* å¯¼å…¥å­—ä½“ */
	@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

	/* CSSå˜é‡å®šä¹‰ä¸»é¢˜ */
	:root {
		--primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		--secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
		--success-gradient: linear-gradient(135deg, #13B0A5 0%, #069B7D 100%);
		--warning-gradient: linear-gradient(135deg, #FA8231 0%, #FFD14C 100%);
		--background: #f0f2f5;
		--card-bg: rgba(255, 255, 255, 0.95);
		--text-primary: #1a202c;
		--text-secondary: #4a5568;
		--border-color: rgba(226, 232, 240, 0.8);
		--shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
		--shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
		--shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
		--shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.08), 0 10px 10px -5px rgba(0, 0, 0, 0.02);
	}

	/* æ·±è‰²æ¨¡å¼ */
	@media (prefers-color-scheme: dark) {
		:root {
			--background: #0f1419;
			--card-bg: rgba(30, 35, 42, 0.95);
			--text-primary: #e2e8f0;
			--text-secondary: #a0aec0;
			--border-color: rgba(45, 55, 72, 0.8);
		}
	}

	body {
		background: var(--background);
		background-image: 
			radial-gradient(circle at 20% 50%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
			radial-gradient(circle at 80% 80%, rgba(118, 75, 162, 0.1) 0%, transparent 50%),
			radial-gradient(circle at 40% 20%, rgba(245, 87, 108, 0.05) 0%, transparent 50%);
		min-height: 100vh;
	}

	.container {
		max-width: 1200px;
		margin: 0 auto;
		padding: 2rem;
		font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		animation: fadeIn 0.6s ease-out;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	header {
		text-align: center;
		margin-bottom: 3rem;
		position: relative;
	}

	header h1 {
		font-size: 3rem;
		font-weight: 800;
		background: var(--primary-gradient);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
		margin-bottom: 0.5rem;
		letter-spacing: -0.02em;
		animation: slideDown 0.8s ease-out;
	}

	@keyframes slideDown {
		from {
			opacity: 0;
			transform: translateY(-30px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	header p {
		color: var(--text-secondary);
		font-size: 1.125rem;
		font-weight: 500;
		animation: fadeIn 1s ease-out 0.3s both;
	}

	.tools-grid {
		display: grid;
		grid-template-columns: 1fr 1fr;
		gap: 2rem;
		animation: fadeIn 0.8s ease-out 0.4s both;
	}

	@media (max-width: 768px) {
		.tools-grid {
			grid-template-columns: 1fr;
		}
		
		header h1 {
			font-size: 2rem;
		}
	}

	section {
		background: var(--card-bg);
		border-radius: 20px;
		padding: 2.5rem;
		box-shadow: var(--shadow-xl);
		border: 1px solid var(--border-color);
		backdrop-filter: blur(10px);
		transition: transform 0.3s ease, box-shadow 0.3s ease;
		position: relative;
		overflow: hidden;
	}

	section::before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		height: 4px;
		background: var(--primary-gradient);
	}

	section:hover {
		transform: translateY(-4px);
		box-shadow: 0 25px 30px -10px rgba(0, 0, 0, 0.1);
	}

	.encoder-section::before {
		background: var(--secondary-gradient);
	}

	section h2 {
		color: var(--text-primary);
		margin-bottom: 2rem;
		font-size: 1.625rem;
		font-weight: 700;
		display: flex;
		align-items: center;
		gap: 0.75rem;
	}

	.input-group {
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
		margin-bottom: 2rem;
	}

	.input-group label {
		font-weight: 600;
		color: var(--text-primary);
		font-size: 0.875rem;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		margin-bottom: 0.25rem;
	}

	.input-group input,
	.input-group select {
		padding: 0.875rem 1rem;
		border: 2px solid var(--border-color);
		border-radius: 12px;
		font-size: 1rem;
		font-weight: 500;
		background: var(--card-bg);
		color: var(--text-primary);
		transition: all 0.3s ease;
		box-shadow: var(--shadow-sm);
	}

	.input-group input:hover,
	.input-group select:hover {
		border-color: #667eea;
		box-shadow: var(--shadow-md);
	}

	.input-group input:focus,
	.input-group select:focus {
		outline: none;
		border-color: #667eea;
		box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
		transform: translateY(-1px);
	}

	.conversion-results,
	.encoding-results {
		display: flex;
		flex-direction: column;
		gap: 1.25rem;
	}

	.result-item {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 1.25rem;
		background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
		border-radius: 12px;
		border: 1px solid rgba(102, 126, 234, 0.2);
		position: relative;
		transition: all 0.3s ease;
		overflow: hidden;
	}

	.result-item::before {
		content: '';
		position: absolute;
		left: 0;
		top: 0;
		bottom: 0;
		width: 4px;
		background: var(--primary-gradient);
	}

	.result-item:hover {
		transform: translateX(4px);
		box-shadow: var(--shadow-md);
		background: linear-gradient(135deg, rgba(102, 126, 234, 0.08) 0%, rgba(118, 75, 162, 0.08) 100%);
	}

	.result-item:nth-child(2)::before {
		background: var(--success-gradient);
	}

	.result-item:nth-child(3)::before {
		background: var(--warning-gradient);
	}

	.result-item:nth-child(4)::before {
		background: var(--secondary-gradient);
	}

	.result-item label {
		font-weight: 600;
		color: var(--text-primary);
		font-size: 0.9rem;
		letter-spacing: 0.025em;
	}

	.result-value {
		font-family: 'JetBrains Mono', 'Courier New', monospace;
		font-weight: 600;
		color: #667eea;
		background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(249, 250, 251, 0.9) 100%);
		padding: 0.625rem 1rem;
		border-radius: 8px;
		border: 1px solid rgba(102, 126, 234, 0.2);
		min-width: 140px;
		text-align: center;
		letter-spacing: 0.05em;
		box-shadow: var(--shadow-sm);
		transition: all 0.3s ease;
	}

	.result-value:hover {
		transform: scale(1.05);
		box-shadow: var(--shadow-md);
	}

	/* IEEE 754 æ ·å¼ */
	.ieee-results {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.ieee-bits {
		display: flex;
		gap: 0.5rem;
		flex-wrap: wrap;
	}

	.bit-group {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;
	}

	.bit-group label {
		font-size: 0.8rem;
		color: var(--text-secondary);
		font-weight: 600;
		text-align: center;
	}

	.bit-box {
		font-family: 'JetBrains Mono', monospace;
		padding: 0.75rem;
		border-radius: 8px;
		text-align: center;
		font-weight: 600;
		letter-spacing: 2px;
		background: var(--card-bg);
		border: 1px solid var(--border-color);
		box-shadow: var(--shadow-sm);
	}

	.bit-group.sign .bit-box {
		background: rgba(245, 87, 108, 0.1);
		border-color: rgba(245, 87, 108, 0.3);
		color: #f5576c;
	}

	.bit-group.exponent .bit-box {
		background: rgba(19, 176, 165, 0.1);
		border-color: rgba(19, 176, 165, 0.3);
		color: #13B0A5;
	}

	.bit-group.mantissa .bit-box {
		background: rgba(102, 126, 234, 0.1);
		border-color: rgba(102, 126, 234, 0.3);
		color: #667eea;
		flex-grow: 1;
	}

	.ieee-hex {
		display: flex;
		align-items: center;
		gap: 1rem;
		padding: 1rem;
		background: var(--background);
		border-radius: 8px;
		border: 1px solid var(--border-color);
	}

	.ieee-hex label {
		font-weight: 600;
		color: var(--text-primary);
	}

	#ieee-hex-result {
		font-family: 'JetBrains Mono', monospace;
		font-weight: 700;
		color: var(--text-primary);
		font-size: 1.1rem;
	}

	.ieee-explanation {
		font-size: 0.9rem;
		color: var(--text-secondary);
		line-height: 1.6;
		padding: 1rem;
		background: rgba(102, 126, 234, 0.05);
		border-radius: 8px;
		border-left: 4px solid #667eea;
	}

	.encoding-item {
		background: linear-gradient(135deg, rgba(240, 93, 155, 0.05) 0%, rgba(245, 87, 108, 0.05) 100%);
		padding: 1.75rem;
		border-radius: 12px;
		border: 1px solid rgba(240, 93, 155, 0.2);
		position: relative;
		transition: all 0.3s ease;
	}

	.encoding-item::before {
		content: '';
		position: absolute;
		left: 0;
		top: 0;
		bottom: 0;
		width: 4px;
		background: var(--secondary-gradient);
	}

	.encoding-item:hover {
		transform: translateY(-2px);
		box-shadow: var(--shadow-lg);
		background: linear-gradient(135deg, rgba(240, 93, 155, 0.08) 0%, rgba(245, 87, 108, 0.08) 100%);
	}

	.encoding-item:nth-child(2)::before {
		background: var(--warning-gradient);
	}

	.encoding-item:nth-child(3)::before {
		background: var(--success-gradient);
	}

	.encoding-item h3 {
		margin: 0 0 1.25rem 0;
		color: var(--text-primary);
		font-size: 1.125rem;
		font-weight: 700;
		letter-spacing: -0.01em;
	}

	.binary-display {
		font-family: 'JetBrains Mono', 'Courier New', monospace;
		font-size: 1.25rem;
		font-weight: 700;
		background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
		padding: 1.25rem;
		background-color: white;
		border-radius: 10px;
		border: 2px solid rgba(240, 93, 155, 0.2);
		text-align: center;
		letter-spacing: 0.15em;
		word-break: break-all;
		margin-bottom: 0.75rem;
		box-shadow: var(--shadow-sm);
		transition: all 0.3s ease;
		position: relative;
	}

	.binary-display::before {
		content: '';
		position: absolute;
		inset: 0;
		background: white;
		border-radius: 10px;
		z-index: -1;
	}

	.binary-display:hover {
		transform: scale(1.02);
		box-shadow: var(--shadow-md);
	}

	.explanation {
		font-size: 0.875rem;
		color: var(--text-secondary);
		padding: 0.75rem;
		background: rgba(102, 126, 234, 0.05);
		border-radius: 8px;
		border: 1px solid rgba(102, 126, 234, 0.1);
		margin-top: 0.5rem;
		transition: all 0.3s ease;
	}

	.explanation:hover {
		background: rgba(102, 126, 234, 0.08);
	}

	.error {
		color: #ef4444 !important;
		background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%) !important;
		border-color: rgba(239, 68, 68, 0.3) !important;
		animation: shake 0.5s ease-in-out;
	}

	@keyframes shake {
		0%, 100% { transform: translateX(0); }
		10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
		20%, 40%, 60%, 80% { transform: translateX(2px); }
	}
</style>

<script>
	// å®æ—¶å¤šè¿›åˆ¶è½¬æ¢å™¨
	class NumberBaseConverter {
		constructor() {
			this.inputNumber = document.getElementById('input-number');
			this.inputBase = document.getElementById('input-base');
			this.resultBinary = document.getElementById('result-binary');
			this.resultOctal = document.getElementById('result-octal');
			this.resultDecimal = document.getElementById('result-decimal');
			this.resultHexadecimal = document.getElementById('result-hexadecimal');

			this.bindEvents();
		}

		bindEvents() {
			this.inputNumber.addEventListener('input', () => this.convert());
			this.inputBase.addEventListener('change', () => this.convert());
		}

		convert() {
			const input = this.inputNumber.value.trim();
			const base = parseInt(this.inputBase.value);

			if (!input) {
				this.clearResults();
				return;
			}

			try {
				// éªŒè¯è¾“å…¥æ˜¯å¦ç¬¦åˆé€‰å®šçš„è¿›åˆ¶
				if (!this.isValidForBase(input, base)) {
					throw new Error('è¾“å…¥ä¸ç¬¦åˆé€‰å®šè¿›åˆ¶');
				}

				// è½¬æ¢ä¸ºåè¿›åˆ¶
				const decimal = parseInt(input, base);
				
				if (isNaN(decimal)) {
					throw new Error('æ— æ•ˆè¾“å…¥');
				}

				// æ›´æ–°å„è¿›åˆ¶ç»“æœ
				this.resultBinary.textContent = decimal.toString(2);
				this.resultOctal.textContent = decimal.toString(8);
				this.resultDecimal.textContent = decimal.toString(10);
				this.resultHexadecimal.textContent = decimal.toString(16).toUpperCase();

				// æ¸…é™¤é”™è¯¯çŠ¶æ€
				this.clearErrorState();

			} catch (error) {
				this.showError();
			}
		}

		isValidForBase(input, base) {
			const validChars = '0123456789ABCDEF'.slice(0, base);
			return input.toUpperCase().split('').every(char => validChars.includes(char));
		}

		clearResults() {
			this.resultBinary.textContent = '-';
			this.resultOctal.textContent = '-';
			this.resultDecimal.textContent = '-';
			this.resultHexadecimal.textContent = '-';
			this.clearErrorState();
		}

		showError() {
			[this.resultBinary, this.resultOctal, this.resultDecimal, this.resultHexadecimal]
				.forEach(el => {
					el.textContent = 'é”™è¯¯';
					el.classList.add('error');
				});
		}

		clearErrorState() {
			[this.resultBinary, this.resultOctal, this.resultDecimal, this.resultHexadecimal]
				.forEach(el => el.classList.remove('error'));
		}
	}

	// æœºå™¨ç ç¼–ç è§£æå™¨
	class MachineCodeEncoder {
		constructor() {
			this.decimalInput = document.getElementById('decimal-input');
			this.bitWidth = document.getElementById('bit-width');
			this.signMagnitude = document.getElementById('sign-magnitude');
			this.onesComplement = document.getElementById('ones-complement');
			this.twosComplement = document.getElementById('twos-complement');
			this.smExplanation = document.getElementById('sm-explanation');
			this.ocExplanation = document.getElementById('oc-explanation');
			this.tcExplanation = document.getElementById('tc-explanation');

			this.bindEvents();
		}

		bindEvents() {
			this.decimalInput.addEventListener('input', () => this.encode());
			this.bitWidth.addEventListener('change', () => this.encode());
		}

		encode() {
			const input = this.decimalInput.value.trim();
			const bits = parseInt(this.bitWidth.value);

			if (!input) {
				this.clearResults();
				return;
			}

			try {
				const decimal = parseInt(input);
				
				if (isNaN(decimal)) {
					throw new Error('æ— æ•ˆè¾“å…¥');
				}

				// æ£€æŸ¥æ•°å€¼èŒƒå›´
				const maxValue = Math.pow(2, bits - 1) - 1;
				const minValue = -Math.pow(2, bits - 1);

				if (decimal > maxValue || decimal < minValue) {
					throw new Error(`è¶…å‡º${bits}ä½èŒƒå›´: [${minValue}, ${maxValue}]`);
				}

				// è®¡ç®—å„ç§ç¼–ç 
				const encodings = this.calculateEncodings(decimal, bits);

				// æ›´æ–°æ˜¾ç¤º
				this.signMagnitude.textContent = encodings.signMagnitude;
				this.onesComplement.textContent = encodings.onesComplement;
				this.twosComplement.textContent = encodings.twosComplement;

				// æ›´æ–°è§£é‡Š
				this.updateExplanations(decimal, bits, encodings);

				// æ¸…é™¤é”™è¯¯çŠ¶æ€
				this.clearErrorState();

			} catch (error) {
				this.showError(error.message);
			}
		}

		calculateEncodings(decimal, bits) {
			const isNegative = decimal < 0;
			const absValue = Math.abs(decimal);

			// åŸç 
			let signMagnitude = absValue.toString(2).padStart(bits - 1, '0');
			signMagnitude = (isNegative ? '1' : '0') + signMagnitude;

			// åç 
			let onesComplement;
			if (isNegative) {
				// è´Ÿæ•°çš„åç ï¼šç¬¦å·ä½ä¸º1ï¼Œå…¶ä½™ä½å–å
				onesComplement = '1' + absValue.toString(2).padStart(bits - 1, '0')
					.split('').map(bit => bit === '0' ? '1' : '0').join('');
			} else {
				// æ­£æ•°çš„åç ç­‰äºåŸç 
				onesComplement = signMagnitude;
			}

			// è¡¥ç 
			let twosComplement;
			if (isNegative) {
				// è´Ÿæ•°çš„è¡¥ç ï¼šåç åŠ 1
				let carry = 1;
				twosComplement = onesComplement.split('').reverse().map(bit => {
					if (carry === 0) return bit;
					if (bit === '0') {
						carry = 0;
						return '1';
					} else {
						return '0';
					}
				}).reverse().join('');
			} else {
				// æ­£æ•°çš„è¡¥ç ç­‰äºåŸç 
				twosComplement = signMagnitude;
			}

			return {
				signMagnitude: this.formatBinary(signMagnitude),
				onesComplement: this.formatBinary(onesComplement),
				twosComplement: this.formatBinary(twosComplement)
			};
		}

		formatBinary(binary) {
			// æ¯4ä½æ·»åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œä¾¿äºé˜…è¯»
			return binary.replace(/(.{4})/g, '$1 ').trim();
		}

		updateExplanations(decimal, bits, encodings) {
			const isNegative = decimal < 0;
			const absValue = Math.abs(decimal);

			if (isNegative) {
				this.smExplanation.textContent = `è´Ÿæ•° ${decimal}ï¼šç¬¦å·ä½=1ï¼Œæ•°å€¼éƒ¨åˆ†=${absValue.toString(2)}`;
				this.ocExplanation.textContent = `è´Ÿæ•°çš„åç ï¼šç¬¦å·ä½=1ï¼Œæ•°å€¼éƒ¨åˆ†å„ä½å–å`;
				this.tcExplanation.textContent = `è´Ÿæ•°çš„è¡¥ç ï¼šåç  + 1`;
			} else {
				this.smExplanation.textContent = `æ­£æ•° ${decimal}ï¼šç¬¦å·ä½=0ï¼Œæ•°å€¼éƒ¨åˆ†=${absValue.toString(2)}`;
				this.ocExplanation.textContent = `æ­£æ•°çš„åç ç­‰äºåŸç `;
				this.tcExplanation.textContent = `æ­£æ•°çš„è¡¥ç ç­‰äºåŸç `;
			}
		}

		clearResults() {
			this.signMagnitude.textContent = '-';
			this.onesComplement.textContent = '-';
			this.twosComplement.textContent = '-';
			this.smExplanation.textContent = '';
			this.ocExplanation.textContent = '';
			this.tcExplanation.textContent = '';
			this.clearErrorState();
		}

		showError(message) {
			[this.signMagnitude, this.onesComplement, this.twosComplement]
				.forEach(el => {
					el.textContent = 'é”™è¯¯: ' + message;
					el.classList.add('error');
				});
		}

		clearErrorState() {
			[this.signMagnitude, this.onesComplement, this.twosComplement]
				.forEach(el => el.classList.remove('error'));
		}
	}

	// IEEE 754 å•ç²¾åº¦æµ®ç‚¹æ•°è½¬æ¢å™¨
	class IEEE754Converter {
		constructor() {
			this.floatInput = document.getElementById('float-input');
			this.signBox = document.getElementById('ieee-sign');
			this.exponentBox = document.getElementById('ieee-exponent');
			this.mantissaBox = document.getElementById('ieee-mantissa');
			this.hexResult = document.getElementById('ieee-hex-result');
			this.explanation = document.getElementById('ieee-explanation');

			this.bindEvents();
		}

		bindEvents() {
			this.floatInput.addEventListener('input', () => this.convert());
		}

		convert() {
			const input = this.floatInput.value.trim();
			
			if (!input) {
				this.clearResults();
				return;
			}

			const floatVal = parseFloat(input);
			if (isNaN(floatVal)) {
				this.clearResults();
				return;
			}

			// ä½¿ç”¨ DataView æ¥è·å– IEEE 754 è¡¨ç¤º
			const buffer = new ArrayBuffer(4);
			const view = new DataView(buffer);
			view.setFloat32(0, floatVal, false); // Big-endian

			const intVal = view.getUint32(0, false);
			const binaryString = intVal.toString(2).padStart(32, '0');

			const sign = binaryString.substring(0, 1);
			const exponent = binaryString.substring(1, 9);
			const mantissa = binaryString.substring(9);

			// æ›´æ–°æ˜¾ç¤º
			this.signBox.textContent = sign;
			this.exponentBox.textContent = this.formatBinary(exponent, 4);
			this.mantissaBox.textContent = this.formatBinary(mantissa, 4);
			
			const hex = intVal.toString(16).toUpperCase().padStart(8, '0');
			this.hexResult.textContent = '0x' + this.formatBinary(hex, 4, '');

			// è§£é‡Š
			this.updateExplanation(floatVal, sign, exponent, mantissa);
		}

		formatBinary(str, chunk = 4, separator = ' ') {
			const regex = new RegExp(`.{1,${chunk}}`, 'g');
			return str.match(regex).join(separator);
		}

		updateExplanation(floatVal, sign, exponent, mantissa) {
			const signDesc = sign === '0' ? 'æ­£æ•° (+)' : 'è´Ÿæ•° (-)';
			
			const expInt = parseInt(exponent, 2);
			const bias = 127;
			const actualExp = expInt - bias;
			
			let mantissaVal = 1;
			for (let i = 0; i < mantissa.length; i++) {
				if (mantissa[i] === '1') {
					mantissaVal += Math.pow(2, -(i + 1));
				}
			}

			let explanationText = `
				<strong>åˆ†æï¼š</strong><br>
				1. ç¬¦å·ä½ (S): ${sign} â†’ ${signDesc}<br>
				2. æŒ‡æ•°ä½ (E): ${exponent} (äºŒè¿›åˆ¶) = ${expInt} (åè¿›åˆ¶)<br>
				   çœŸå®æŒ‡æ•° = E - Bias = ${expInt} - ${bias} = ${actualExp}<br>
				3. å°¾æ•°ä½ (M): ${mantissa}<br>
				   (éšå« 1) . ${mantissa}<br>
				<br>
				<strong>è®¡ç®—å…¬å¼ï¼š</strong><br>
				Value = (-1)<sup>S</sup> Ã— (1.M) Ã— 2<sup>E-Bias</sup><br>
				Value = ${sign === '0' ? 1 : -1} Ã— ${mantissaVal.toFixed(6)}... Ã— 2<sup>${actualExp}</sup> â‰ˆ ${floatVal}
			`;

            // ç‰¹æ®Šå€¼å¤„ç†
            if (expInt === 255) {
                if (parseInt(mantissa, 2) !== 0) {
                    explanationText = "<strong>NaN (Not a Number)</strong>: æŒ‡æ•°å…¨1ï¼Œå°¾æ•°é0";
                } else {
                    explanationText = `<strong>${sign === '0' ? '+Infinity' : '-Infinity'}</strong>: æŒ‡æ•°å…¨1ï¼Œå°¾æ•°å…¨0`;
                }
            } else if (expInt === 0) {
                 if (parseInt(mantissa, 2) !== 0) {
                    explanationText = `<strong>éè§„æ ¼åŒ–æ•° (Denormalized)</strong>: æŒ‡æ•°å…¨0ï¼Œå°¾æ•°é0<br>çœŸå®æŒ‡æ•° = 1 - 127 = -126`;
                } else {
                    explanationText = `<strong>${sign === '0' ? '+0' : '-0'}</strong>: æŒ‡æ•°å…¨0ï¼Œå°¾æ•°å…¨0`;
                }
            }

			this.explanation.innerHTML = explanationText;
		}

		clearResults() {
			this.signBox.textContent = '-';
			this.exponentBox.textContent = '-';
			this.mantissaBox.textContent = '-';
			this.hexResult.textContent = '-';
			this.explanation.textContent = '';
		}
	}

	// åˆå§‹åŒ–
	document.addEventListener('DOMContentLoaded', () => {
		new NumberBaseConverter();
		new MachineCodeEncoder();
		new IEEE754Converter();
	});
</script>
